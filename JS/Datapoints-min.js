var bruh=new Audio("click.mp3"),focused_datapoint=null,datapoints=[],current_datatype="",POPUP_MODE=!1,SIDEBAR={title:0,description:0,image:0},POPUP={element:null,header:null,dtype:null,audio:null,text:null};async function setup_local(){print("Starting local setup"),SIDEBAR={};let[e,t,a]=gid("desktop-sidebar").children;SIDEBAR.title=e,SIDEBAR.description=t,SIDEBAR.image=a;let s=gid("datapoint-popup"),[i,n,o,l]=gid("popup-info").children;POPUP={element:s,header:i,dtype:n,audio:o,text:l},setup_datatype_links(),setup_close_buttons(),setup_datapoint_numbers(),set_datapoint_events(),set_datapoint_expansion_sizes(),document.body.classList.add("classic-layout")}function resize_handler_local(){set_datapoint_expansion_sizes()}function is_classic_layout(){return!mobile_mode&&document.body.classList.contains("classic-layout")}function setup_datatype_links(){for(const e of gid("datapoint-types-inner").children)e.onclick=(t=>{let a=document.querySelector(".datatype-selected");a&&a.classList.remove("datatype-selected"),e.classList.add("datatype-selected"),current_datatype&&gid(current_datatype).classList.remove("shown"),current_datatype=e.getAttribute("target"),[...document.getElementsByClassName("datatype-poster")].forEach(e=>{e.src=`Images/${current_datatype.startsWith("Text")?"text":current_datatype.toLowerCase()}-poster.png`}),gid("datatype-container").classList.add("shown"),gid(current_datatype).classList.add("shown"),gid("datapoint-types").classList.remove("shown"),datapoints=gid(current_datatype).querySelector(".datapoint-container").children,is_classic_layout()&&focus_datapoint(datapoints[0])})}function setup_close_buttons(){for(const e of document.querySelectorAll(".datatype-title > img"))e.onclick=(t=>{if(e.parentElement.parentElement.classList.remove("shown"),gid("datatype-container").classList.remove("shown"),gid("datapoint-types").classList.add("shown"),focused_datapoint&&focused_datapoint.getAttribute("media-type")){let e=focused_datapoint.querySelector("audio");e.pause(),e.currentTime=0}})}function setup_datapoint_numbers(){[...document.getElementsByClassName("datapoint-container")].forEach(e=>{[...e.children].forEach((e,t)=>{e.setAttribute("position",t+1);let a=e.getAttribute("media-type");if(a){let s=e.querySelector(".datapoint-audio");s.onclick=(e=>e.stopPropagation());let i=s.firstElementChild;i.onclick=(e=>{e.stopPropagation(),toggle_audio_playback(i.previousElementSibling)});let n=document.createElement("AUDIO");n.preload="metadata",e.lastElementChild.firstElementChild.prepend(n),n.src=`Audio/HZD ${a} ${t+1}.mp3`,n.addEventListener("timeupdate",function(){update_progress_bar(this)}),n.onended=(e=>{n.parentElement.classList.remove("playing")})}})});let e=gid("popup-content"),t=e.querySelector(".datapoint-audio").children[1];t.onclick=(e=>{e.stopPropagation(),toggle_audio_playback(t.previousElementSibling)});let a=e.querySelector("audio");a.addEventListener("timeupdate",function(){update_progress_bar(this)}),a.onended=(e=>{a.parentElement.classList.remove("playing")})}function close_popup(){POPUP_MODE=!1,POPUP.element.classList.remove("shown"),gid("popup-content").getAttribute("media-type")&&(POPUP.audio.classList.remove("playing"),POPUP.audio.firstElementChild.pause(),POPUP.audio.firstElementChild.currentTime=0)}function set_datapoint_expansion_sizes(){for(const e of document.getElementsByClassName("datapoint")){let t=e.querySelector("text").offsetHeight;e.style=`--datapoint-text-size: ${t}px`}}function set_datapoint_events(){for(const e of document.getElementsByClassName("datapoint")){e.firstElementChild.onclick=(e=>{e.stopPropagation(),select_datapoint()}),e.onmouseover=(t=>{focus_datapoint(e)}),e.onclick=(t=>{is_classic_layout()?init_popup(e):select_datapoint()})}}function init_popup(e){POPUP_MODE=!0;let t=e.getAttribute("media-type");t&&gid("popup-content").setAttribute("media-type",t),POPUP.header.innerHTML=e.firstElementChild.firstElementChild.innerHTML,POPUP.dtype.innerHTML=current_datatype,t&&(POPUP.audio.firstElementChild.src=e.getElementsByTagName("audio")[0].src),POPUP.text.innerHTML=e.lastElementChild.lastElementChild.innerHTML,POPUP.element.classList.add("shown")}function focus_datapoint(e){focused_datapoint!=e&&(focused_datapoint&&focused_datapoint.classList.remove("focused"),focused_datapoint=e,e.classList.add("focused"),SIDEBAR.title.innerHTML=e.firstElementChild.firstElementChild.innerHTML,SIDEBAR.description.innerHTML=e.getAttribute("description"))}function select_datapoint(){let e=document.querySelector(".datapoint.selected");if(e==focused_datapoint)return e.classList.remove("selected"),void(e.getAttribute("media-type")&&(e.getElementsByTagName("audio")[0].pause(),e.getElementsByTagName("audio")[0].currentTime=0,e.getElementsByTagName("audio")[0].parentElement.classList.remove("playing")));e&&(e.getAttribute("media-type")&&e.getElementsByTagName("audio")[0].pause(),e.classList.remove("selected")),focused_datapoint.classList.add("selected")}function prepare_datapoint_expansions(){for(const e of document.getElementsByClassName("datapoint-title")){let t=e.parentElement;e.onclick=(e=>{if(is_classic_layout())return;if(t.classList.contains("selected"))return void t.classList.remove("selected");let a=document.querySelector(".datapoint.selected");a&&a.classList.remove("selected"),t.classList.add("selected")})}for(const e of document.getElementsByClassName("datapoint"))e.onmouseover=(t=>{is_classic_layout()&&!e.classList.contains("selected")&&(document.querySelector(".datapoint.selected").classList.remove("selected"),e.classList.add("selected"),new Audio("click2.mp3").play())}),e.onclick=(t=>{is_classic_layout()&&activate_datapoint(e)})}function setup_key_presses(){document.body.onkeydown=(e=>{let t=e.key;if(POPUP_MODE)"f"==t?toggle_audio_playback(POPUP.audio.firstElementChild):"Escape"==t&&close_popup();else if("q"==t)go_to_previous_page();else if("e"==t)go_to_next_page();else if("Tab"==t)e.preventDefault(),toggle_layout();else if("f"==t)is_classic_layout()?init_popup(focused_datapoint):select_datapoint();else if(is_classic_layout()){let e=parseInt(getComputedStyle(gid(current_datatype).getElementsByClassName("datapoint-container")[0]).getPropertyValue("--columns")),a=0,s=parseInt(focused_datapoint.getAttribute("position"));if("w"==t||"ArrowUp"==t)a=s-e;else if("s"==t||"ArrowDown"==t)a=s+e;else if("d"==t||"ArrowRight"==t)a=s+1;else{if("a"!=t&&"ArrowLeft"!=t)return;a=s-1}focus_datapoint(datapoints[Math.max(1,Math.min(datapoints.length,a))-1])}else if("w"==t||"ArrowUp"==t){let e=focused_datapoint.previousElementSibling;e&&(focus_datapoint(e),e.parentElement.click(),e.scrollIntoView({block:"center"}))}else if("s"==t||"ArrowDown"==t){let e=focused_datapoint.nextElementSibling;e&&(focus_datapoint(e),e.parentElement.click(),e.scrollIntoView({block:"center"}))}else print(t)})}function toggle_layout(){document.body.classList.contains("classic-layout")?document.body.classList.remove("classic-layout"):document.body.classList.add("classic-layout")}function toggle_audio_playback(e){e.paused?(e.play(),e.parentElement.classList.add("playing")):(e.pause(),e.parentElement.classList.remove("playing"))}function update_progress_bar(e){e.parentElement.style=`--perc: ${100*e.currentTime/e.duration}%`}